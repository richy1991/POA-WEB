<!-- informes/templates/informes/reporte_poa.html -->
<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Reporte POA - UABJB</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        .card-header {
            background-color: #003366;
            color: white;
        }
        .table th {
            background-color: #e9ecef;
        }
        .estado-pendiente { background-color: #fff3cd; }
        .estado-en_curso { background-color: #d1ecf1; }
        .estado-realizado { background-color: #d4edda; }
        .estado-suspendido { background-color: #f8d7da; }
    </style>
</head>
<body>
    <div class="container-fluid mt-4">
        <div class="card">
            <div class="card-header text-center">
                <h2>PLAN OPERATIVO ANUAL (POA) - GESTIÓN 2026</h2>
                <h5>Carrera de Ingeniería de Sistemas</h5>
            </div>
            <div class="card-body">
                <!-- Filtros -->
                <form method="get" class="row g-3 mb-4">
                    <div class="col-md-3">
                        <label for="gestion" class="form-label">Gestión</label>
                        <select class="form-select" name="gestion" id="gestion">
                            <option value="">-- Todas --</option>
                            {% for g in gestiones %}
                                <option value="{{ g.gestion__id }}" {% if filtros_aplicados.gestion|stringformat:"s" == g.gestion__id|stringformat:"s" %}selected{% endif %}>
                                    {{ g.gestion__año }}
                                </option>
                            {% endfor %}
                        </select>
                    </div>
                    <div class="col-md-3">
                        <label for="programa" class="form-label">Programa</label>
                        <select class="form-select" name="programa" id="programa">
                            <option value="">-- Todos --</option>
                            {% for p in programas %}
                                <option value="{{ p.objetivo_especifico__programa__id }}" {% if filtros_aplicados.programa|stringformat:"s" == p.objetivo_especifico__programa__id|stringformat:"s" %}selected{% endif %}>
                                    {{ p.objetivo_especifico__programa__codigo }} - {{ p.objetivo_especifico__programa__nombre|truncatechars:30 }}
                                </option>
                            {% endfor %}
                        </select>
                    </div>
                    <div class="col-md-3">
                        <label for="unidad" class="form-label">Unidad</label>
                        <select class="form-select" name="unidad" id="unidad">
                            <option value="">-- Todas --</option>
                            {% for u in unidades %}
                                <option value="{{ u.unidad_solicitante__id }}" {% if filtros_aplicados.unidad|stringformat:"s" == u.unidad_solicitante__id|stringformat:"s" %}selected{% endif %}>
                                    {{ u.unidad_solicitante__nombre }}
                                </option>
                            {% endfor %}
                        </select>
                    </div>
                    <div class="col-md-3">
                        <label for="estado" class="form-label">Estado</label>
                        <select class="form-select" name="estado" id="estado">
                            <option value="">-- Todos --</option>
                            {% for key, value in estados %}
                                <option value="{{ key }}" {% if filtros_aplicados.estado == key %}selected{% endif %}>{{ value }}</option>
                            {% endfor %}
                        </select>
                    </div>
                    <div class="col-12">
                        <button type="submit" class="btn btn-primary">Filtrar</button>
                        <a href="{% url 'informes:reporte_poa' %}" class="btn btn-secondary">Limpiar</a>
                    </div>
                </form>

                <!-- Resumen -->
                <div class="alert alert-info mb-4">
                    <strong>Total de Actividades:</strong> {{ total_actividades }} |
                    <strong>Presupuesto Total:</strong> Bs. {{ total_monto|floatformat:2 }}
                </div>

                <!-- Tabla de Actividades -->
                <div class="table-responsive">
                    <table class="table table-bordered table-striped table-hover">
                        <thead class="table-dark">
                            <tr>
                                <th>Código</th>
                                <th>Actividad</th>
                                <th>Programa</th>
                                <th>Unidad</th>
                                <th>Responsable</th>
                                <th>Producto Esperado</th>
                                <th>Monto (Bs.)</th>
                                <th>Estado</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for a in actividades %}
                                <tr class="estado-{{ a.estado }}">
                                    <td>{{ a.codigo }}</td>
                                    <td>{{ a.nombre }}</td>
                                    <td>
                                        {{ a.objetivo_especifico.programa.codigo }}<br>
                                        <small>{{ a.objetivo_especifico.programa.nombre|truncatechars:50 }}</small>
                                    </td>
                                    <td>{{ a.unidad_solicitante.nombre }}</td>
                                    <td>{{ a.responsable.nombre }}</td>
                                    <td>{{ a.producto_esperado|truncatechars:80 }}</td>
                                    <td class="text-end">{{ a.monto_asignado|floatformat:2 }}</td>
                                    <td>
                                        <span class="badge bg-{{ a.estado|yesno:"warning,info,success,danger" }}">
                                            {{ a.get_estado_display }}
                                        </span>
                                    </td>
                                </tr>
                            {% empty %}
                                <tr>
                                    <td colspan="8" class="text-center">No se encontraron actividades con los filtros aplicados.</td>
                                </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>